const isArray=e=>Array.isArray(e);const asArray=e=>isArray(e)?e:[e];let Queue=function(e){let add=function(e){asArray(e).forEach((e=>t.set(Symbol(e.char?.innerText),buildQueueItem({...e}))));return this};let getTypeable=()=>rawValues().filter((e=>e.typeable));let set=function(e,s){let i=[...t.keys()];t.set(i[e],buildQueueItem(s))};let buildQueueItem=e=>{e.shouldPauseCursor=function(){return Boolean(this.typeable||this.cursorable||this.deletable)};return e};let reset=function(){t.forEach((e=>delete e.done))};let wipe=function(){t=new Map;add(e)};let getQueue=()=>t;let rawValues=()=>Array.from(t.values());let destroy=e=>t.delete(e);let getItems=(e=false)=>e?rawValues():rawValues().filter((e=>!e.done));let done=(e,s=false)=>s?t.delete(e):t.get(e).done=true;let t=new Map;add(e);return{add:add,set:set,wipe:wipe,done:done,reset:reset,destroy:destroy,getItems:getItems,getQueue:getQueue,getTypeable:getTypeable}};const e="data-typeit-id";const t="ti-cursor";const s="END";const i={started:false,completed:false,frozen:false,destroyed:false};const r={breakLines:true,cursor:{autoPause:true,autoPauseDelay:500,animation:{frames:[0,0,1].map((e=>({opacity:e}))),options:{iterations:Infinity,easing:"steps(2, start)",fill:"forwards"}}},cursorChar:"|",cursorSpeed:1e3,deleteSpeed:null,html:true,lifeLike:true,loop:false,loopDelay:750,nextStringDelay:750,speed:100,startDelay:250,startDelete:false,strings:[],waitUntilVisible:false,beforeString:()=>{},afterString:()=>{},beforeStep:()=>{},afterStep:()=>{},afterComplete:()=>{}};const n=`[${e}]:before {content: '.'; display: inline-block; width: 0; visibility: hidden;}`;const createElement=e=>document.createElement(e);const createTextNode=e=>document.createTextNode(e);const appendStyleBlock=(e,t="")=>{let s=createElement("style");s.id=t;s.appendChild(createTextNode(e));document.head.appendChild(s)};const calculateDelay=e=>{isArray(e)||(e=[e/2,e/2]);return e};const randomInRange=(e,t)=>Math.abs(Math.random()*(e+t-(e-t))+(e-t));let range=e=>e/2;function calculatePace(e){let{speed:t,deleteSpeed:s,lifeLike:i}=e;s=s!==null?s:t/3;return i?[randomInRange(t,range(t)),randomInRange(s,range(s))]:[t,s]}const toArray=e=>Array.from(e);let expandTextNodes=e=>{[...e.childNodes].forEach((e=>{if(e.nodeValue){[...e.nodeValue].forEach((t=>{e.parentNode.insertBefore(createTextNode(t),e)}));e.remove()}else expandTextNodes(e)}));return e};const getParsedBody=e=>{let t=document.implementation.createHTMLDocument();t.body.innerHTML=e;return expandTextNodes(t.body)};function walkElementNodes(e,s=false,i=false){let r=e.querySelector(`.${t}`);let n=document.createTreeWalker(e,NodeFilter.SHOW_ALL,{acceptNode:e=>{if(r&&i){if(e.classList?.contains(t))return NodeFilter.FILTER_ACCEPT;if(r.contains(e))return NodeFilter.FILTER_REJECT}return e.classList?.contains(t)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}});let o;let a=[];while(o=n.nextNode()){o.originalParent||(o.originalParent=o.parentNode);a.push(o)}return s?a.reverse():a}function chunkStringAsHtml(e){return walkElementNodes(getParsedBody(e))}function maybeChunkStringAsHtml(e,t=true){return t?chunkStringAsHtml(e):toArray(e).map(createTextNode)}const isNumber=e=>Number.isInteger(e);const countStepsToSelector=({queueItems:e,selector:t,cursorPosition:i,to:r})=>{if(isNumber(t))return t*-1;let n=new RegExp(s,"i").test(r);let o=t?[...e].reverse().findIndex((({char:e})=>{let s=e.parentElement;let i=s.matches(t);return!(!n||!i)||i&&s.firstChild.isSameNode(e)})):-1;o<0&&(o=n?0:e.length-1);let a=n?0:1;return o-i+a};const destroyTimeouts=e=>{e.forEach(clearTimeout);return[]};const duplicate=(e,t)=>new Array(t).fill(e);let beforePaint=e=>new Promise((t=>{requestAnimationFrame((async()=>{t(await e())}))}));let getAnimationFromElement=e=>e?.getAnimations().find((t=>t.id===e.dataset.tiAnimationId));let setCursorAnimation=({cursor:e,frames:t,options:s})=>{let i=e.animate(t,s);i.pause();i.id=e.dataset.tiAnimationId;beforePaint((()=>{beforePaint((()=>{i.play()}))}));return i};let rebuildCursorAnimation=({cursor:e,options:t,cursorOptions:s})=>{if(!e||!s)return;let i=getAnimationFromElement(e);let r;if(i){t.delay=i.effect.getComputedTiming().delay;r=i.currentTime;i.cancel()}let n=setCursorAnimation({cursor:e,frames:s.animation.frames,options:t});r&&(n.currentTime=r);return n};let execute=e=>e.func?.call(null);let fireItem=async({index:e,queueItems:t,wait:s,cursor:i,cursorOptions:r})=>{let n=t[e][1];let o=[];let a=e;let l=n;let shouldBeGrouped=()=>l&&!l.delay;let u=n.shouldPauseCursor()&&r.autoPause;while(shouldBeGrouped()){o.push(l);shouldBeGrouped()&&a++;l=t[a]?t[a][1]:null}if(o.length){await beforePaint((async()=>{for(let e of o)await execute(e)}));return a-1}let h=getAnimationFromElement(i);let d;h&&(d={...h.effect.getComputedTiming(),delay:u?r.autoPauseDelay:0});await s((async()=>{h&&u&&h.cancel();await beforePaint((()=>{execute(n)}))}),n.delay);await rebuildCursorAnimation({cursor:i,options:d,cursorOptions:r});return e};const fireWhenVisible=(e,t)=>{let s=new IntersectionObserver(((s,i)=>{s.forEach((s=>{if(s.isIntersecting){t();i.unobserve(e)}}))}),{threshold:1});s.observe(e)};const generateHash=()=>Math.random().toString().substring(2,9);const isInput=e=>"value"in e;let getAllChars=e=>isInput(e)?toArray(e.value):walkElementNodes(e,true).filter((e=>!(e.childNodes.length>0)));let handleFunctionalArg=e=>typeof e==="function"?e():e;let select=(e,t=document,s=false)=>t["querySelector"+(s?"All":"")](e);let isBodyElement=e=>/body/i.test(e?.tagName);let insertIntoElement=(e,s)=>{if(isInput(e)){e.value=`${e.value}${s.textContent}`;return}s.innerHTML="";let i=isBodyElement(s.originalParent)?e:s.originalParent||e;i.insertBefore(s,select("."+t,i)||null)};const isNonVoidElement=e=>/<(.+)>(.*?)<\/(.+)>/.test(e.outerHTML);const merge=(e,t)=>Object.assign({},e,t);let processCursorOptions=e=>{if(typeof e==="object"){let t={};let{frames:s,options:i}=r.cursor.animation;t.animation=e.animation||{};t.animation.frames=e.animation?.frames||s;t.animation.options=merge(i,e.animation?.options||{});t.autoPause=e.autoPause??r.cursor.autoPause;t.autoPauseDelay=e.autoPauseDelay||r.cursor.autoPauseDelay;return t}return e===true?r.cursor:e};const removeNode=(e,t)=>{if(!e)return;let s=e.parentNode;let i=s.childNodes.length>1||s.isSameNode(t)?e:s;i.remove()};const repositionCursor=(e,s,i)=>{let r=s[i-1];let n=select(`.${t}`,e);e=r?.parentNode||e;e.insertBefore(n,r||null)};function selectorToElement(e){return typeof e==="string"?select(e):e}let o={"font-family":"","font-weight":"","font-size":"","font-style":"","line-height":"",color:"",transform:"translateX(-.125em)"};let setCursorStyles=(s,i)=>{let r=`[${e}='${s}']`;let n=`${r} .${t}`;let a=getComputedStyle(i);let l=Object.entries(o).reduce(((e,[t,s])=>`${e} ${t}: var(--ti-cursor-${t}, ${s||a[t]});`),"");appendStyleBlock(`${n} { display: inline-block; width: 0; ${l} }`,s)};function splitOnBreak(e){return e.replace(/<!--(.+?)-->/g,"").trim().split(/<br(?:\s*?)(?:\/)?>/)}let updateCursorPosition=(e,t,s)=>Math.min(Math.max(t+e,0),s.length);let wait=(e,t,s)=>new Promise((i=>{let cb=async()=>{await e();i()};s.push(setTimeout(cb,t||0))}));class TypeIt{element;timeouts;cursorPosition;predictedCursorPosition;statuses={started:false,completed:false,frozen:false,destroyed:false};opts;id;queue;cursor;unfreeze=()=>{};constructor(e,t={}){this.opts=merge(r,t);this.element=selectorToElement(e);this.timeouts=[];this.cursorPosition=0;this.unfreeze=()=>{};this.predictedCursorPosition=null;this.statuses=merge({},i);this.id=generateHash();this.queue=Queue([{delay:this.opts.startDelay}]);this.#e(t);this.cursor=this.#t();this.element.dataset.typeitId=this.id;appendStyleBlock(n);this.opts.strings.length&&this.#s()}go(){if(this.statuses.started)return this;this.#i();if(!this.opts.waitUntilVisible){this.#r();return this}fireWhenVisible(this.element,this.#r.bind(this));return this}destroy(e=true){this.timeouts=destroyTimeouts(this.timeouts);handleFunctionalArg(e)&&this.cursor&&this.#n(this.cursor);this.statuses.destroyed=true}reset(e){!this.is("destroyed")&&this.destroy();if(e){this.queue.wipe();e(this)}else this.queue.reset();this.cursorPosition=0;for(let e in this.statuses)this.statuses[e]=false;this.element[this.#o()?"value":"innerHTML"]="";return this}is=function(e){return this.statuses[e]};type(e,t={}){e=handleFunctionalArg(e);let{instant:s}=t;let i=this.#a(t);let r=maybeChunkStringAsHtml(e,this.opts.html);let n=r.map((e=>({func:()=>this.#l(e),char:e,delay:s||isNonVoidElement(e)?0:this.#u(),typeable:e.nodeType===Node.TEXT_NODE})));let o=[i[0],{func:async()=>await this.opts.beforeString(e,this)},...n,{func:async()=>await this.opts.afterString(e,this)},i[1]];return this.#h(o,t)}break(e={}){return this.#h({func:()=>this.#l(createElement("BR")),typeable:true},e)}move(e,t={}){e=handleFunctionalArg(e);let s=this.#a(t);let{instant:i,to:r}=t;let n=countStepsToSelector({queueItems:this.queue.getTypeable(),selector:e===null?"":e,to:r,cursorPosition:this.#d});let o=n<0?-1:1;this.predictedCursorPosition=this.#d+n;return this.#h([s[0],...duplicate({func:()=>this.#c(o),delay:i?0:this.#u(),cursorable:true},Math.abs(n)),s[1]],t)}exec(e,t={}){let s=this.#a(t);return this.#h([s[0],{func:()=>e(this)},s[1]],t)}options(e,t={}){e=handleFunctionalArg(e);this.#p(e);return this.#h({},t)}pause(e,t={}){return this.#h({delay:handleFunctionalArg(e)},t)}delete(e=null,t={}){e=handleFunctionalArg(e);let s=this.#a(t);let i=e;let{instant:r,to:n}=t;let o=this.queue.getTypeable();let a=(()=>i===null?o.length:isNumber(i)?i:countStepsToSelector({queueItems:o,selector:i,cursorPosition:this.#d,to:n}))();return this.#h([s[0],...duplicate({func:this.#f.bind(this),delay:r?0:this.#u(1),deletable:true},a),s[1]],t)}freeze(){this.statuses.frozen=true}flush(e=(()=>{})){this.#i();this.#r(false).then(e);return this}getQueue(){return this.queue}getOptions(){return this.opts}updateOptions(e){return this.#p(e)}getElement(){return this.element}empty(e={}){return this.#h({func:this.#m.bind(this)},e)}async#m(){this.#o()?this.element.value="":this.#y.forEach(this.#n.bind(this))}
/**
   * Execute items in the queue.
   *
   * @param remember If false, each queue item will be destroyed once executed.
   * @returns
   */async#r(e=true){this.statuses.started=true;let cleanUp=t=>{this.queue.done(t,!e)};try{let t=[...this.queue.getQueue()];for(let e=0;e<t.length;e++){let[s,i]=t[e];if(!i.done){if(!i.deletable||i.deletable&&this.#y.length){let s=await this.#g(e,t);Array(s-e).fill(e+1).map(((e,t)=>e+t)).forEach((e=>{let[s]=t[e];cleanUp(s)}));e=s}cleanUp(s)}}if(!e)return this;this.statuses.completed=true;await this.opts.afterComplete(this);if(!this.opts.loop)throw"";let s=this.opts.loopDelay;this.#b((async()=>{await this.#P(s[0]);this.#r()}),s[1])}catch(e){}return this}async#c(e){this.cursorPosition=updateCursorPosition(e,this.cursorPosition,this.#y);repositionCursor(this.element,this.#y,this.cursorPosition)}async#P(e){let t=this.#d;t&&await this.#c({value:t});let s=this.#y.map((e=>[Symbol(),{func:this.#f.bind(this),delay:this.#u(1),deletable:true,shouldPauseCursor:()=>true}]));for(let e=0;e<s.length;e++)await this.#g(e,s);this.queue.reset();this.queue.set(0,{delay:e})}#g(e,t){return fireItem({index:e,queueItems:t,wait:this.#b.bind(this),cursor:this.cursor,cursorOptions:this.opts.cursor})}async#b(e,t,s=false){this.statuses.frozen&&await new Promise((e=>{this.unfreeze=()=>{this.statuses.frozen=false;e()}}));s||await this.opts.beforeStep(this);await wait(e,t,this.timeouts);s||await this.opts.afterStep(this)}async#i(){!this.#o()&&this.cursor&&this.element.appendChild(this.cursor);if(this.#C){setCursorStyles(this.id,this.element);this.cursor.dataset.tiAnimationId=this.id;let{animation:e}=this.opts.cursor;let{frames:t,options:s}=e;setCursorAnimation({frames:t,cursor:this.cursor,options:{duration:this.opts.cursorSpeed,...s}})}}#o(){return isInput(this.element)}#h(e,t){this.queue.add(e);this.#w(t);return this}#w(e={}){let t=e.delay;t&&this.queue.add({delay:t})}#a(e={}){return[{func:()=>this.#p(e)},{func:()=>this.#p(this.opts)}]}async#p(e){this.opts=merge(this.opts,e)}#s(){let e=this.opts.strings.filter((e=>!!e));e.forEach(((t,s)=>{this.type(t);if(s+1===e.length)return;let i=this.opts.breakLines?[{func:()=>this.#l(createElement("BR")),typeable:true}]:duplicate({func:this.#f.bind(this),delay:this.#u(1)},this.queue.getTypeable().length);this.#T(i)}))}#e=e=>{e.cursor=processCursorOptions(e.cursor??r.cursor);this.opts.strings=this.#I(asArray(this.opts.strings));this.opts=merge(this.opts,{html:!this.#S&&this.opts.html,nextStringDelay:calculateDelay(this.opts.nextStringDelay),loopDelay:calculateDelay(this.opts.loopDelay)})};#I(e){let t=this.element.innerHTML;if(!t)return e;this.element.innerHTML="";if(this.opts.startDelete){this.element.innerHTML=t;expandTextNodes(this.element);this.#T(duplicate({func:this.#f.bind(this),delay:this.#u(1),deletable:true},this.#y.length));return e}return splitOnBreak(t).concat(e)}#t(){if(this.#S)return null;let e=createElement("span");e.className=t;if(!this.#C){e.style.visibility="hidden";return e}e.innerHTML=getParsedBody(this.opts.cursorChar).innerHTML;return e}#T(e){let t=this.opts.nextStringDelay;this.queue.add([{delay:t[0]},...e,{delay:t[1]}])}#l(e){insertIntoElement(this.element,e)}#f(){this.#y.length&&(this.#S?this.element.value=this.element.value.slice(0,-1):this.#n(this.#y[this.cursorPosition]))}#n(e){removeNode(e,this.element)}#u(e=0){return calculatePace(this.opts)[e]}get#d(){return this.predictedCursorPosition??this.cursorPosition}get#S(){return isInput(this.element)}get#C(){return!!this.opts.cursor&&!this.#S}get#y(){return getAllChars(this.element)}}export{TypeIt as default};

